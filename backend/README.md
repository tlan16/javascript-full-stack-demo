# Dabus Dashboard

### Local development setup

Create `.env` based on `.env.example
```shell script
cp .env .env.example
```

Install packages
```shell script
npm install
```

Load environment variables into shell 
```shell script
source .env
````

Start dev server
```shell script
npm start
```


The frontend app should now be running at `http://127.0.0.1:3000`.

Use plugins like [Host Switch Plus](https://chrome.google.com/webstore/detail/host-switch-plus/bopepoejgapmihklfepohbilpkcdoaeo) for in-browser host change. 

```dotenv
IP: 127.0.0.1:3000
Domain: dashboard.dabus.io
```

Now Enter `http://dashboard.dabus.io/` you will be redirect to the auth url like:
 ```log
https://auth.dabus.io/login?response_type=token&client_id=4c02rtgc2eu4kl8ah56q5113ak&redirect_uri=https://dashboard.dabus.io/login.html
```

Once signed in, AWS will redirect you to the https auth redirect url like:
```log
https://dashboard.dabus.io/login.html#id_token=eyJraWQiOiJqbmtxRWRaN0JIUWZkYnVGNzNTQnBYdXBLY29lUmxMOEl0eko2WDZIUWNVPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiTExHd1NPU3VNZzFhZGEwUnpLVXBNUSIsInN1YiI6IjM5NzU0NGJmLTI0ZTMtNDdlNS1iNGRhLTIxZjEwN2U3NzNhMiIsImNvZ25pdG86Z3JvdXBzIjpbImRhc2hib2FyZC1qYXNjbyJdLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLmFwLXNvdXRoZWFzdC0yLmFtYXpvbmF3cy5jb21cL2FwLXNvdXRoZWFzdC0yX0Y2bTlBYmFYMSIsInBob25lX251bWJlcl92ZXJpZmllZCI6dHJ1ZSwiY29nbml0bzp1c2VybmFtZSI6ImZyYW5rbGFuIiwiYXVkIjoiNGMwMnJ0Z2MyZXU0a2w4YWg1NnE1MTEzYWsiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTU2Njc5MjgxMiwicGhvbmVfbnVtYmVyIjoiKzYxNDM1NzUzNDEzIiwiZXhwIjoxNTY2Nzk2NDEyLCJpYXQiOjE1NjY3OTI4MTIsImVtYWlsIjoiZnJhbmtsYW4xMThAZ21haWwuY29tIn0.xQ3y3E39kZ0KL6aL2hwmxuBqW1mqy--H4FOsYpFC-3YGPI8kr3noTKh-rKGOVvfk2VoBu4D-VQvw7OcUEQ1lzKMEp0MLmCjNVHvzmYP3GN2Ui_AjM1yRDWqme4s5rt5COtNWKJR2fKOFD_1WkfQPxEtDz-lgndOprWRS6rfIZoUAImId1uYz9YFUhfMSPNlPLFi2QDYQx0_5Yqq6Bk24BaLHQUuQZqRxDTENNy9ybJF4BC_M1lRVDNFWs4OtWWb_n1howE-HsHhkMGJPPGS5b5nWqq5miLotW_9Bkjq3wGWRR1RSfWP-VxXNtsa44IXxO8Mbja58OOodpyH8Kx29sA&access_token=eyJraWQiOiI4dFFcLzltMHdPdXdHaUV3bnNXSUNsYlJnVFdmOEUxUVwvM2ZKTVBNRFlFM2s9IiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiIzOTc1NDRiZi0yNGUzLTQ3ZTUtYjRkYS0yMWYxMDdlNzczYTIiLCJjb2duaXRvOmdyb3VwcyI6WyJkYXNoYm9hcmQtamFzY28iXSwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJkYWJ1c19wcm9kdWN0aW9uXC90b3RhbHRvb2xzIG9wZW5pZCIsImF1dGhfdGltZSI6MTU2Njc5MjgxMiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLmFwLXNvdXRoZWFzdC0yLmFtYXpvbmF3cy5jb21cL2FwLXNvdXRoZWFzdC0yX0Y2bTlBYmFYMSIsImV4cCI6MTU2Njc5NjQxMiwiaWF0IjoxNTY2NzkyODEyLCJ2ZXJzaW9uIjoyLCJqdGkiOiIwMDRlMmY5OC1jZTI2LTQ2MjItYTJmZC02YzE5MDQ3NGExNDkiLCJjbGllbnRfaWQiOiI0YzAycnRnYzJldTRrbDhhaDU2cTUxMTNhayIsInVzZXJuYW1lIjoiZnJhbmtsYW4ifQ.ihlCbIrD0FO5ICnFBATm3TNtfqSQA5cTXn4uu60CgmZj5WbFjvpStU-h36ItP2x21fHti_twx9jG8JCT45KCqU3KcA5JweXHen1qsR5kWomuHswVvlnlZVF69Wj0_9Ij8oUMe4JmYvZ8CKWCW0PR3RUY9YVp6WlvTB_N2WSOLJhAWd-xRMZHy66epHStfQPk_meMnqhCx2YlqP-IfcMw7TJ7XS7NrpWQx74dXXJ5LlSAOsoocz43Z4nvHqU7Y9ylznXzV1rfhY1kBGMrYAjLjgsq5vJAqdYtNfW88pbutY4Ya3-Ku3Fp92xSdsOGGtSbxnAgq845IE7oQUuzbLWspg&expires_in=3600&token_type=Bearer
```

Because https is not supported by the chrome plugin, to make it work, you need to change `https` to `http`. Everything else in the url must _not_ be changed. 
```log
http://dashboard.dabus.io/login.html#id_token=eyJraWQiOiJqbmtxRWRaN0JIUWZkYnVGNzNTQnBYdXBLY29lUmxMOEl0eko2WDZIUWNVPSIsImFsZyI6IlJTMjU2In0.eyJhdF9oYXNoIjoiTExHd1NPU3VNZzFhZGEwUnpLVXBNUSIsInN1YiI6IjM5NzU0NGJmLTI0ZTMtNDdlNS1iNGRhLTIxZjEwN2U3NzNhMiIsImNvZ25pdG86Z3JvdXBzIjpbImRhc2hib2FyZC1qYXNjbyJdLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLmFwLXNvdXRoZWFzdC0yLmFtYXpvbmF3cy5jb21cL2FwLXNvdXRoZWFzdC0yX0Y2bTlBYmFYMSIsInBob25lX251bWJlcl92ZXJpZmllZCI6dHJ1ZSwiY29nbml0bzp1c2VybmFtZSI6ImZyYW5rbGFuIiwiYXVkIjoiNGMwMnJ0Z2MyZXU0a2w4YWg1NnE1MTEzYWsiLCJ0b2tlbl91c2UiOiJpZCIsImF1dGhfdGltZSI6MTU2Njc5MjgxMiwicGhvbmVfbnVtYmVyIjoiKzYxNDM1NzUzNDEzIiwiZXhwIjoxNTY2Nzk2NDEyLCJpYXQiOjE1NjY3OTI4MTIsImVtYWlsIjoiZnJhbmtsYW4xMThAZ21haWwuY29tIn0.xQ3y3E39kZ0KL6aL2hwmxuBqW1mqy--H4FOsYpFC-3YGPI8kr3noTKh-rKGOVvfk2VoBu4D-VQvw7OcUEQ1lzKMEp0MLmCjNVHvzmYP3GN2Ui_AjM1yRDWqme4s5rt5COtNWKJR2fKOFD_1WkfQPxEtDz-lgndOprWRS6rfIZoUAImId1uYz9YFUhfMSPNlPLFi2QDYQx0_5Yqq6Bk24BaLHQUuQZqRxDTENNy9ybJF4BC_M1lRVDNFWs4OtWWb_n1howE-HsHhkMGJPPGS5b5nWqq5miLotW_9Bkjq3wGWRR1RSfWP-VxXNtsa44IXxO8Mbja58OOodpyH8Kx29sA&access_token=eyJraWQiOiI4dFFcLzltMHdPdXdHaUV3bnNXSUNsYlJnVFdmOEUxUVwvM2ZKTVBNRFlFM2s9IiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiIzOTc1NDRiZi0yNGUzLTQ3ZTUtYjRkYS0yMWYxMDdlNzczYTIiLCJjb2duaXRvOmdyb3VwcyI6WyJkYXNoYm9hcmQtamFzY28iXSwidG9rZW5fdXNlIjoiYWNjZXNzIiwic2NvcGUiOiJkYWJ1c19wcm9kdWN0aW9uXC90b3RhbHRvb2xzIG9wZW5pZCIsImF1dGhfdGltZSI6MTU2Njc5MjgxMiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLmFwLXNvdXRoZWFzdC0yLmFtYXpvbmF3cy5jb21cL2FwLXNvdXRoZWFzdC0yX0Y2bTlBYmFYMSIsImV4cCI6MTU2Njc5NjQxMiwiaWF0IjoxNTY2NzkyODEyLCJ2ZXJzaW9uIjoyLCJqdGkiOiIwMDRlMmY5OC1jZTI2LTQ2MjItYTJmZC02YzE5MDQ3NGExNDkiLCJjbGllbnRfaWQiOiI0YzAycnRnYzJldTRrbDhhaDU2cTUxMTNhayIsInVzZXJuYW1lIjoiZnJhbmtsYW4ifQ.ihlCbIrD0FO5ICnFBATm3TNtfqSQA5cTXn4uu60CgmZj5WbFjvpStU-h36ItP2x21fHti_twx9jG8JCT45KCqU3KcA5JweXHen1qsR5kWomuHswVvlnlZVF69Wj0_9Ij8oUMe4JmYvZ8CKWCW0PR3RUY9YVp6WlvTB_N2WSOLJhAWd-xRMZHy66epHStfQPk_meMnqhCx2YlqP-IfcMw7TJ7XS7NrpWQx74dXXJ5LlSAOsoocz43Z4nvHqU7Y9ylznXzV1rfhY1kBGMrYAjLjgsq5vJAqdYtNfW88pbutY4Ya3-Ku3Fp92xSdsOGGtSbxnAgq845IE7oQUuzbLWspg&expires_in=3600&token_type=Bearer
```

Now the browser should redirect to `http://dashboard.dabus.io/` and showing the charts. 

#### FAQ
***Dashboard crashes or showing error/blank page after sign in***

This is usually due to no user group is assigned to the auth user. Note that one user should and can only belongs to one user group. This is managed in AWS Cognito. 

### Build / Deployment Process

From your local workstation:

1) Use phing to rebuild the HTML for each client:

```
$ phing
```

2) Commit the changes and push as usual

```
$ git commit 
```
